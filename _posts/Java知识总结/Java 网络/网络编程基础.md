## 局域网与因特网

服务器是指提供信息的计算机或者程序，客户机是指请求信息的计算机或者程序，而网络用于连接客户机和服务器，实现两者的通信。

局域网(LAN)是一群通过特定形式连接到一起的计算机，由局域网延伸到更大的范围就是广域网。

### 网络协议

网络协议规定了计算机之间的物理、机械(网卡与网卡的连接规定)、电气(有效的电平范围)等特征以及计算机之间的相互寻址地址、数据发送冲突的解决及长的数据如何发送和接受等。

#### IP地址

IP是Internet Protocol的简称，它是一种网络协议。Internet采用的是TCP/IP协议。

每台主机用在网络上为其分配的Internet地址表示自己，这个地址就是IP地址。IP地址用4个字节，也就是32位的二进制数表示，称为IPv4。为了方便使用，通常取每个字节的十进制数，并且每个字节之间用圆点隔开来表示IP地址，如192.168.1.1。现在，人们在尝试使用16个字节表示IP地址，这就是IPv6。

TCP/IP模式是一种层次结构，共4层，分别为应用层、传输层、互联网层和网络层。

#### TCP与UDP协议

在TCP/IP协议栈中，有两个高级协议需要了解，一个是传输控制协议(TCP)，一个是用户数据报协议(UDP)。

TCP协议是一种以固定连线为基础的协议，它提供两台计算机间可靠的数据传输。它可以保证一个数据可以从一端确实送到另一端，而且抵达的数据的排列和送出时的顺序相同。

UDP是无连接的通信协议，不保证可靠的数据传输，但能向多个目标发送数据，接收发自多个数据源的数据。它以独立发送数据包的方式进行，发送的顺序可能和接受的顺序不同。

#### 端口和套接字

一般来说，一台计算机只有单一的连接到网络的物理连接，所有的数据都通过此连接对内、对外送达特定的计算机，这就是端口(port)。网络程序设计中的端口并不是真实的物理存在，而已一个假想的连接装置。端口被规定为一个在0～65535之间的整数。通常，0～1023之间的端口数用于一些知名的网络服务和应用，所以我们应该使用1024以上的端口，以免发生端口冲突。

网络中的套接字(Socket)用于将应用程序和端口连接起来，他也是一个假想的连接装置。

## TCP程序设计基础

TCP网络程序设计是指利用Socket类编写通信程序。其进行通信的应用程序，一个称为服务器程序，另一个称为客户端程序。

>服务器程序创建一个ServerSocket(服务器套接字)/，调用accept()方法等待客户机来连接；客户端创建一个Socket，请求与服务器连接；服务器接收到客户机的请求，同时创建一个新的Socket与客户建立连接。服务器继续等待新的请求。

### InetAddress类

它是与IP地址相关的类，利用该类可以获取IP地址、主机地址等信息。其常用方法有：

1、getByName(String host):返回Host相对应的InetAddress对象

2、getHostAddress():返回InetAddress对象所包含的IP地址

3、getHostName():获取此IP地址的主机名

4、getLocalHost():返回本地主机的InetAddress对象

### ServerSocket类

表示服务器套接字，其主要功能是等待来自网络上的请求，它可以通过指定的端口来等待连接的套接字。服务器套接字一次可以与一个套接字连接，如果多台客户机同时提出连接请求，服务器套接字会将请求连接的客户机存入队列中，然后从中取出一个套接字，与服务器新建的套接字连接。如果请求的连接数大于容纳数(默认为50)，则多出的连接请求被拒绝。

构造方法(ss表示ServerSocket)：

1、ss():创建非绑定服务器套接字

2、ss(int port):创建绑定到特定端口的服务器套接字

3、ss(int port,int backlog):利用指定的backlog创建服务器套接字并将其绑定到指定的端口

4、ss(int port,int backlog,InetAddress bindAddress):使用指定的端口、倾听backlog今儿要绑定到的本地IP地址创建服务器

常用的方法有：

1、accept():等待客户机的连接，若连接，则创建一套接字

2、isBound():判断绑定状态

3、getInetAddress():返回此服务器套接字的本地地址

4、isClosed():返回服务器套接字的关闭状态

5、close():关闭服务器套接字

6、bind(SocketAddress endpoint):将ServerSocket绑定到特定地址

7、getInetAddress():返回服务器套接字的端口号

accept()方法会返回一个和客户端Socket对象相连接的Socket对象，服务器端的Socket对象使用getOutputStream()方法获得的输出流将指向客户端Socket对象使用getInputStream()方法获得的那个输入流，反之亦然。

>accept()方法会阻塞线程的继续执行，直到接收到客户的呼叫

### TCP网络程序

在编程中，如果只需要客户机向服务器发送消息，不要求服务器向客户机发送消息，称为单向通信。

## UDP程序设计基础

使用UDP传递信息比较快，但是不提供可靠的保证。使用UDP传递数据时，用户无法知道数据能否正确到达主机，也不确定到达的顺序。

UDP程序的步骤：

发送数据包：

1、使用DatagramSocket()创建一个数据包套接字

2、使用DatagramPacket(byte[] buf,int offset,int length,InetAddress address,int port)创建要发送的数据包

3、使用DatagramSocket类的send()方法发送数据包

接受数据包：

1、使用DatagramSocket(int port)创建数据包套接字，绑定到指定的端口

2、使用DatagramPacket(byte[] buf,int length)创建字节数组来接受数据包

3、使用DatagramPacket类的receive()接收UDP包

>正常情况receive()会阻塞，直到有数据传来

### DatagramPacket类

构造函数：

1、DatagramPacket(byte[] buf,int length):指定数据包的内存空间和大小

2、DatagramPacket(byte[] buf,int offset,int length,InetAddress address,int port):指定数据包的内存空间、大小、目标地址和端口。

### DatagramSocket类

构造函数：

1、DatagramSocket():构造数据报套接字并将其绑定到本地主机任何可用的端口

2、DatagramSocket(int port):构造数据报套接字并将其绑定到本地主机的指定端口

3、DatagramSocket(int port,InetAddress addr):构造数据报套接字并将其绑定到指定的本地地址

在接收程序时，必须指定一个端口号，不要让系统随机生成。



